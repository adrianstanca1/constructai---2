<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ConstructAI - Interactive Platform Showcase</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals with a Deep Blue accent -->
    <!-- Application Structure Plan: The SPA is structured into four thematic, navigable sections: 'Home' (the value proposition), 'Platform Features' (interactive module explorer), 'The AI Core' (a visual deep-dive into the unique AI agents), and 'Connectivity & Vision' (integrations and future plans). This structure was chosen to transform a dense text document into an engaging, explorable pitch. The primary interaction is a persistent top navigation bar. Key interactions include filterable, clickable cards in the 'Features' section and an interactive HTML/CSS diagram in 'The AI Core' that animates a workflow scenario. This approach allows potential stakeholders to quickly grasp the high-level benefits or delve into the specific aspects that interest them most, which is more effective for a proposal than a linear document. -->
    <!-- Visualization & Content Choices: 
        - Report Info: Core Platform Features -> Goal: Organize/Inform -> Viz: Grid of interactive cards with filters -> Interaction: User clicks a filter (e.g., 'Financial') to see relevant feature cards. Clicking a card expands it to show details and the "AI Improvement". -> Justification: Breaks down a long list of features into a manageable, user-driven discovery process. -> Library/Method: Vanilla JS, Tailwind CSS.
        - Report Info: The Five AI Agents & their interaction -> Goal: Explain a complex system/Wow -> Viz: HTML/CSS-based hub-and-spoke diagram -> Interaction: User clicks an agent's name to view its detailed description. A separate button triggers an animated sequence that highlights each agent in the "Imagine this:" scenario, showing their collaboration. -> Justification: Visually communicates the platform's core differentiator—the multi-agent system—in a way static text cannot. -> Library/Method: Vanilla JS, Tailwind CSS.
        - Report Info: Connectivity & Challenges -> Goal: Inform -> Viz: Structured text sections with icons -> Interaction: None, static information -> Justification: Simple, clear presentation for foundational information. -> Library/Method: HTML/CSS with Unicode characters for icons.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9; /* slate-100 */
            color: #3d3d3d;
        }
        .nav-active {
            color: #2563eb; /* Blue-600 */
            border-bottom: 2px solid #2563eb;
            font-weight: 600;
        }
        .nav-item {
            transition: color 0.3s ease, border-color 0.3s ease;
            border-bottom: 2px solid transparent;
        }
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .feature-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .feature-card .details {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out, padding 0.5s ease-in-out;
        }
        .feature-card.open .details {
            max-height: 500px;
            padding-top: 1rem;
        }
        .filter-btn.active {
            background-color: #2563eb;
            color: white;
        }
        #ai-hub {
            z-index: 20;
        }
        .ai-agent-node {
            transition: all 0.3s ease;
            cursor: pointer;
            z-index: 20;
        }
        .ai-agent-node.active, .ai-agent-node:hover {
            background-color: #2563eb;
            color: white;
            transform: scale(1.05);
        }
        .ai-scenario-path {
            position: absolute;
            background-color: #fbbf24; /* Amber-400 */
            height: 3px;
            transform-origin: left center;
            width: 0;
            opacity: 0;
            transition: width 0.5s ease-in-out, opacity 0.3s ease-in-out;
            z-index: 10;
        }
        .ai-agent-node.highlight {
             background-color: #fbbf24;
             color: #3d3d3d;
             box-shadow: 0 0 15px rgba(251, 191, 36, 0.7);
             animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1.05); }
            50% { transform: scale(1.15); }
        }
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
        }
        .modal-overlay {
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.75);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            animation: fadeIn 0.3s ease-in-out;
        }
        .modal-content {
            position: relative;
            max-width: 90vw;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .modal-content img {
            max-width: 100%;
            max-height: 80vh;
            object-fit: contain;
            border-radius: 0.5rem;
        }
        .modal-close-btn, .modal-nav-btn {
            position: absolute;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            border-radius: 9999px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s ease;
        }
        .modal-close-btn:hover, .modal-nav-btn:hover {
            background-color: rgba(0, 0, 0, 0.8);
        }
        .modal-close-btn {
            top: 1rem;
            right: 1rem;
            width: 2.5rem;
            height: 2.5rem;
            z-index: 110;
        }
        .modal-nav-btn {
            top: 50%;
            transform: translateY(-50%);
            width: 3rem;
            height: 3rem;
        }
        .modal-nav-btn.prev { left: 1rem; }
        .modal-nav-btn.next { right: 1rem; }
        .modal-caption {
            margin-top: 0.5rem;
            color: white;
            text-align: center;
            padding: 0.5rem 1rem;
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 0.25rem;
            max-width: 80%;
        }
        .scenario-btn {
            width: 100%;
            padding: 0.5rem 1rem;
            border: 1px solid #e2e8f0; /* slate-200 */
            border-radius: 0.375rem;
            text-align: left;
            font-size: 0.875rem;
            color: #475569; /* slate-600 */
            background-color: white;
            transition: all 0.2s ease;
        }
        .scenario-btn:hover:not(:disabled) {
            background-color: #f1f5f9; /* slate-100 */
            border-color: #cbd5e1; /* slate-300 */
        }
        .scenario-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
    </style>
<script type="importmap">
{
  "imports": {
    "react-dom/client": "https://aistudiocdn.com/react-dom@19.2.0/client",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.22.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/"
  }
}
</script>
</head>
<body class="antialiased">
    <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-50 border-b border-gray-200">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <span class="text-2xl font-bold text-blue-600">ConstructAI</span>
                </div>
                <nav id="desktop-nav" class="hidden md:flex space-x-6">
                    <!-- Marketing Nav -->
                    <button data-target="home" class="nav-item nav-active text-sm font-medium marketing-nav">Home</button>
                    <button data-target="features" class="nav-item text-sm font-medium marketing-nav">Platform Features</button>
                    <button data-target="ai-core" class="nav-item text-sm font-medium marketing-nav">The AI Core</button>
                    <button data-target="connectivity" class="nav-item text-sm font-medium marketing-nav">Connectivity</button>
                    <button data-target="get-started" class="nav-item text-sm font-medium marketing-nav">Get Started</button>
                </nav>
                <div class="flex items-center">
                    <button id="auth-button" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-md hover:bg-blue-700 transition-colors text-sm flex items-center"></button>
                    <div class="md:hidden ml-4">
                        <button id="mobile-menu-button" class="text-gray-600 hover:text-gray-800">
                            <span class="sr-only">Open main menu</span>
                            <div class="w-6 h-6 flex flex-col justify-around">
                               <span class="block w-full h-0.5 bg-current"></span>
                               <span class="block w-full h-0.5 bg-current"></span>
                               <span class="block w-full h-0.5 bg-current"></span>
                            </div>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div id="mobile-menu" class="hidden md:hidden">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                 <!-- Marketing Nav -->
                <button data-target="home" class="mobile-nav-item marketing-nav block w-full text-left px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-gray-50">Home</button>
                <button data-target="features" class="mobile-nav-item marketing-nav block w-full text-left px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-gray-50">Platform Features</button>
                <button data-target="ai-core" class="mobile-nav-item marketing-nav block w-full text-left px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-gray-50">The AI Core</button>
                <button data-target="connectivity" class="mobile-nav-item marketing-nav block w-full text-left px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-gray-50">Connectivity</button>
                <button data-target="get-started" class="mobile-nav-item marketing-nav block w-full text-left px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-gray-50">Get Started</button>
            </div>
        </div>
    </header>

    <main id="marketing-container" class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <section id="home" class="content-section active text-center">
            <h1 class="text-4xl md:text-5xl font-bold tracking-tight text-gray-900">Build Smarter, Not Harder.</h1>
            <p class="mt-4 text-lg text-gray-600 max-w-3xl mx-auto">ConstructAI is the all-in-one platform that gives construction SMBs the power of a large enterprise. We unify project management and accounting with a suite of powerful AI agents to boost profitability and reduce risk.</p>
            <div class="mt-8">
                <button data-target="get-started" class="nav-item-direct bg-blue-600 text-white font-bold py-3 px-8 rounded-md hover:bg-blue-700 transition-colors">Request a Demo</button>
            </div>
            <div class="mt-12 grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="bg-white p-6 rounded-lg shadow-md border border-gray-100">
                    <h3 class="text-xl font-semibold text-blue-600">Unified Workflow</h3>
                    <p class="mt-2 text-gray-600">Replace disconnected tools with a single source of truth for project and financial data, eliminating errors and saving time.</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md border border-gray-100">
                    <h3 class="text-xl font-semibold text-blue-600">Proactive Insights</h3>
                    <p class="mt-2 text-gray-600">Our AI agents don't just report data—they analyze it to predict delays, forecast cash flow, and offer strategic advice.</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md border border-gray-100">
                    <h3 class="text-xl font-semibold text-blue-600">Increased Profitability</h3>
                    <p class="mt-2 text-gray-600">With real-time job costing, AI-powered estimates, and automated compliance, you can make decisions that directly improve your bottom line.</p>
                </div>
            </div>
        </section>

        <section id="features" class="content-section">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold">A Comprehensive Toolset for Modern Construction</h2>
                <p class="mt-2 text-gray-600 max-w-3xl mx-auto">ConstructAI integrates every facet of your business. Explore our core features below, each enhanced with intelligent automation to streamline your operations. Click on any card to see details.</p>
            </div>
            <div class="flex justify-center space-x-1 sm:space-x-2 mb-8 bg-gray-100 p-2 rounded-lg max-w-md mx-auto">
                <button class="filter-btn active flex-1 px-3 py-2 text-xs sm:text-sm font-medium rounded-md" data-filter="all">All</button>
                <button class="filter-btn flex-1 px-3 py-2 text-xs sm:text-sm font-medium rounded-md" data-filter="project">Project Ops</button>
                <button class="filter-btn flex-1 px-3 py-2 text-xs sm:text-sm font-medium rounded-md" data-filter="financial">Financial Mgt</button>
                <button class="filter-btn flex-1 px-3 py-2 text-xs sm:text-sm font-medium rounded-md" data-filter="business">Business Dev</button>
            </div>
            <div id="features-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            </div>
        </section>
        
        <section id="ai-core" class="content-section">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold">The AI Core: Your Digital Team of Experts</h2>
                <p class="mt-2 text-gray-600 max-w-3xl mx-auto">Five specialized AI agents work collaboratively behind the scenes, acting as your 24/7 project manager, accountant, and business advisor. Click an agent to learn more, or run a scenario to see them in action.</p>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2 relative h-[500px] bg-white rounded-lg shadow-md border border-gray-100 p-8 flex items-center justify-center">
                    <div id="ai-hub" class="w-40 h-40 rounded-full bg-blue-600 text-white flex flex-col items-center justify-center text-center p-4 shadow-xl">
                        <span class="font-bold text-lg">AI Core</span>
                        <span class="text-xs">Central Intelligence</span>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md border border-gray-100 flex flex-col">
                    <div id="ai-controls">
                        <h4 class="text-lg font-semibold text-gray-800 mb-3">Run a Scenario</h4>
                        <div id="scenario-buttons-container" class="space-y-2 mb-6">
                            <button class="scenario-btn" data-scenario="safetyHazard">
                                <span class="font-bold">Scenario 1:</span> Daily Log Safety Alert
                            </button>
                            <button class="scenario-btn" data-scenario="weatherDelay">
                                <span class="font-bold">Scenario 2:</span> Weather Delay Prediction
                            </button>
                            <button class="scenario-btn" data-scenario="smartRFI">
                                <span class="font-bold">Scenario 3:</span> Smart RFI Resolution
                            </button>
                        </div>
                    </div>
                    <div class="border-t pt-4 flex-grow flex flex-col">
                        <h3 id="ai-agent-title" class="text-2xl font-semibold text-blue-600 mb-2">User Assistant</h3>
                        <p id="ai-agent-description" class="text-gray-600 flex-grow">The user-facing chatbot or voice assistant. Users can ask questions in natural language (“What were our profits last quarter?”) and get instant answers, making the complex system incredibly user-friendly.</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="connectivity" class="content-section">
             <div class="text-center mb-12">
                <h2 class="text-3xl font-bold">Connectivity, Security, and Vision</h2>
                <p class="mt-2 text-gray-600 max-w-3xl mx-auto">Our platform is built to integrate seamlessly into your existing ecosystem while providing enterprise-grade security and a clear roadmap for future growth.</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="bg-white p-6 rounded-lg shadow-md border border-gray-100">
                    <h3 class="text-2xl font-semibold mb-4">Integrations & Scalability</h3>
                    <ul class="space-y-4 text-gray-600">
                        <li class="flex items-start"><span class="text-blue-500 mr-3 mt-1 font-bold">✓</span><span><strong>Government Integration:</strong> Connects with tax authorities like HMRC (UK) or the IRS (US) for direct digital filings.</span></li>
                        <li class="flex items-start"><span class="text-blue-500 mr-3 mt-1 font-bold">✓</span><span><strong>Open Banking:</strong> Uses open banking APIs to integrate with banks globally for live, automated transaction feeds.</span></li>
                        <li class="flex items-start"><span class="text-blue-500 mr-3 mt-1 font-bold">✓</span><span><strong>Third-Party Plugins:</strong> Offers connectors to popular tools like Xero, QuickBooks, and Microsoft 365 to avoid data silos.</span></li>
                        <li class="flex items-start"><span class="text-blue-500 mr-3 mt-1 font-bold">✓</span><span><strong>Cloud Infrastructure:</strong> Being cloud-based, the application scales with your business’s growth, with data stored securely.</span></li>
                    </ul>
                </div>
                 <div class="bg-white p-6 rounded-lg shadow-md border border-gray-100">
                    <h3 class="text-2xl font-semibold mb-4">Addressing Key Challenges</h3>
                    <ul class="space-y-4 text-gray-600">
                        <li class="flex items-start"><span class="text-blue-500 mr-3 mt-1 font-bold">✓</span><span><strong>Data Security:</strong> Enterprise-grade cloud infrastructure employing end-to-end encryption and multi-factor authentication.</span></li>
                        <li class="flex items-start"><span class="text-blue-500 mr-3 mt-1 font-bold">✓</span><span><strong>AI Accuracy:</strong> We implement a "human-in-the-loop" system. AI suggestions are always presented for user review and final approval.</span></li>
                        <li class="flex items-start"><span class="text-blue-500 mr-3 mt-1 font-bold">✓</span><span><strong>User Adoption:</strong> Our design philosophy is "powerful, yet simple," led by the conversational AI assistant to lower the learning curve for all users.</span></li>
                    </ul>
                </div>
            </div>
             <div class="mt-12 bg-white p-8 rounded-lg shadow-md border border-gray-100">
                <h3 class="text-2xl font-bold mb-4 text-center">The Vision Forward</h3>
                <div class="relative mt-4">
                    <div class="absolute left-1/2 w-0.5 h-full bg-blue-200 -translate-x-1/2"></div>
                    <div class="space-y-8">
                        <div class="flex items-center" data-step="1"><div class="w-4 h-4 bg-blue-500 rounded-full z-10"></div><p class="ml-4 font-semibold">Platform Launch & Beta Program</p></div>
                        <div class="flex items-center" data-step="2"><div class="w-4 h-4 bg-blue-500 rounded-full z-10"></div><p class="ml-4 font-semibold">Supply Chain Optimization AI Module</p></div>
                        <div class="flex items-center" data-step="3"><div class="w-4 h-4 bg-blue-500 rounded-full z-10"></div><p class="ml-4 font-semibold">Predictive Safety & Risk Analysis</p></div>
                        <div class="flex items-center" data-step="4"><div class="w-4 h-4 bg-blue-500 rounded-full z-10"></div><p class="ml-4 font-semibold">International Market Expansion</p></div>
                    </div>
                </div>
            </div>
        </section>

        <section id="get-started" class="content-section">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold">Ready to Build a Better Business?</h2>
                <p class="mt-2 text-gray-600 max-w-3xl mx-auto">Choose a plan that fits your needs or contact us for a personalized demo to see how ConstructAI can transform your operations.</p>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-5 gap-8">
                <div class="lg:col-span-3 grid grid-cols-1 md:grid-cols-2 gap-8 items-stretch">
                    <div class="bg-white p-8 rounded-lg shadow-md border border-gray-100 flex flex-col">
                        <h3 class="text-2xl font-bold text-center">Starter</h3>
                        <p class="mt-2 text-gray-500 text-center">For small teams and freelancers.</p>
                        <p class="my-8 text-center"><span class="text-5xl font-bold">£99</span><span class="text-gray-500">/mo</span></p>
                        <ul class="space-y-3 text-gray-600 mb-8 flex-grow">
                            <li class="flex items-center"><span class="text-blue-500 mr-2">✓</span> Up to 5 Projects</li>
                            <li class="flex items-center"><span class="text-blue-500 mr-2">✓</span> Core Project Management</li>
                            <li class="flex items-center"><span class="text-blue-500 mr-2">✓</span> Basic Accounting & Invoicing</li>
                        </ul>
                        <button class="w-full bg-blue-100 text-blue-700 font-bold py-3 px-4 rounded-md hover:bg-blue-200 transition-colors">Choose Plan</button>
                    </div>
                    <div class="bg-blue-600 text-white p-8 rounded-lg shadow-xl border border-blue-700 flex flex-col ring-4 ring-blue-200">
                        <h3 class="text-2xl font-bold text-center">Professional</h3>
                        <p class="mt-2 text-blue-200 text-center">For growing businesses.</p>
                        <p class="my-8 text-center"><span class="text-5xl font-bold">£249</span><span class="text-blue-200">/mo</span></p>
                        <ul class="space-y-3 text-blue-100 mb-8 flex-grow">
                            <li class="flex items-center"><span class="mr-2">✓</span> Unlimited Projects</li>
                            <li class="flex items-center"><span class="mr-2">✓</span> All Starter Features</li>
                            <li class="flex items-center"><span class="mr-2">✓</span> Full AI Agent Suite</li>
                            <li class="flex items-center"><span class="mr-2">✓</span> Third-Party Integrations</li>
                        </ul>
                        <button class="w-full bg-white text-blue-700 font-bold py-3 px-4 rounded-md hover:bg-gray-100 transition-colors">Choose Plan</button>
                    </div>
                </div>
                <div class="lg:col-span-2 bg-white p-8 rounded-lg shadow-md border border-gray-100">
                    <h3 class="text-2xl font-bold text-center mb-4">Request a Demo</h3>
                    <form id="demo-form">
                        <div class="space-y-4">
                            <div>
                                <label for="name" class="block text-sm font-medium text-gray-700">Full Name</label>
                                <input type="text" id="name" name="name" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div>
                                <label for="email" class="block text-sm font-medium text-gray-700">Email Address</label>
                                <input type="email" id="email" name="email" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            </div>
                             <div>
                                <label for="company" class="block text-sm font-medium text-gray-700">Company Name</label>
                                <input type="text" id="company" name="company" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div>
                                <button type="submit" id="demo-submit-btn" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">Submit Request</button>
                            </div>
                        </div>
                        <p id="form-feedback" class="text-sm text-center mt-4"></p>
                    </form>
                </div>
            </div>
        </section>
    </main>

    <div id="app-container" class="hidden">
        <div id="root"></div>
    </div>

    <script type="module" src="/index.tsx"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        let db, auth;

        async function initializeFirebase() {
            try {
                if (typeof __firebase_config === 'undefined' || !__firebase_config) {
                    console.warn('Firebase config not provided. Demo form submissions will not work.');
                    return;
                }
                const firebaseConfig = JSON.parse(__firebase_config);
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
            } catch (error) {
                console.error("Firebase initialization failed:", error);
            }
        }

        const featuresData = [
            { name: 'Document Management', category: 'project', icon: '🗂️', description: 'Centralized repository for all project documents with version control and real-time collaboration.', improvement: 'AI-driven tagging and search to automatically categorize files and flag compliance issues.' },
            { name: 'Estimating & Budgeting', category: 'project', icon: '🧮', description: 'Go beyond traditional estimating. Build project estimates with reusable templates, backed by a regularly updated cost database.', improvement: 'Our AI estimator supercharges your bids by analyzing your company\'s historical project data and current market trends. It identifies cost patterns and predicts expenses with greater accuracy, giving you a competitive edge.' },
            { name: 'Change Order Management', category: 'project', icon: '🔄', description: 'Systematic way to track changes in project scope, route them for approval, and update budgets.', improvement: 'Automation prompts users to create change orders when it detects alterations in plans or budgets.' },
            { name: 'Purchase Order Management', category: 'project', icon: '🛒', description: 'Manage procurement, track deliveries, and monitor supplier performance with approval workflows.', improvement: 'AI can optimize procurement by suggesting order timing to get bulk discounts or avoid shortages.' },
            { name: 'Scheduling & Time Tracking', category: 'project', icon: '🗓️', description: 'Robust scheduling with Gantt charts, resource allocation, and time sheet management for job costing.', improvement: 'AI scheduling assistant analyzes plans to optimize resource usage and dynamically adjust for delays.' },
            { name: 'Field Collaboration Tools', category: 'project', icon: '📱', description: 'Mobile app for daily logs, RFIs, and punch lists with real-time messaging and notifications.', improvement: 'Conversational AI allows field workers to log updates via voice or chat.' },
            { name: 'Invoicing & Billing', category: 'financial', icon: '🧾', description: 'Generate various client invoices, manage retainers, and automate creation from project data.', improvement: 'AI sends automated payment reminders and can forecast cash flow based on billing schedules.' },
            { name: 'Reporting & Analytics', category: 'financial', icon: '📊', description: 'Customizable dashboards and reports for project status, budget vs. actual, and resource utilization.', improvement: 'Our AI goes beyond simple reporting. It continuously analyzes project data—schedules, costs, and field logs—to identify subtle patterns and produce predictive insights, flagging projects at risk of budget overruns or schedule delays before they become critical issues.' },
            { name: 'Integrated Accounting', category: 'financial', icon: '🏦', description: 'A full premium accounting service built-in, from bookkeeping to tax filing.', improvement: 'AI bookkeeper helps categorize transactions from automated bank feeds, and the system connects to tax authorities.' },
            { name: 'CRM & Contact Management', category: 'business', icon: '👥', description: 'Built-in CRM to track leads, clients, contracts, and manage all communications.', improvement: 'AI can perform sentiment analysis on messages to identify unhappy clients or prospects needing follow-up.' }
        ];

        const aiAgentsData = [
            { id: 'agent-pm', name: 'Project Management Optimizer', description: 'Uses predictive analytics to foresee potential project issues, recalculates optimal schedules, and instantly shows the ripple effects of change orders on timelines and budgets.' },
            { id: 'agent-biz', name: 'Business Advisor', description: 'Acts as a virtual business consultant, analyzing performance data and industry benchmarks to give strategic advice, such as identifying new market opportunities or relevant government grants.' },
            { id: 'agent-doc', name: 'Document & Compliance Analyst', description: 'Reviews documents and contracts to extract key obligations, add reminders, and check for compliance issues, like ensuring subcontractor insurance is up to date.' },
            { id: 'agent-acc', name: 'Accounting & Compliance Agent', description: 'Handles the heavy lifting of bookkeeping, classifies transactions, and ensures alignment with accounting standards and tax rules. It stays up-to-date on regulations and can produce complex tax documents automatically.' },
            { id: 'agent-user', name: 'User Assistant', description: 'The user-facing chatbot or voice assistant. Users can ask questions in natural language (“What were our profits last quarter?”) and get instant answers, making the complex system incredibly user-friendly.' }
        ];
        
        const navButtons = document.querySelectorAll('.nav-item');
        const mobileNavButtons = document.querySelectorAll('.mobile-nav-item');
        const directNavLinks = document.querySelectorAll('.nav-item-direct');
        const contentSections = document.querySelectorAll('.content-section');
        const featuresGrid = document.getElementById('features-grid');
        const filterButtons = document.querySelectorAll('.filter-btn');
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        
        const authButton = document.getElementById('auth-button');
        const marketingContainer = document.getElementById('marketing-container');
        const appContainer = document.getElementById('app-container');

        let state = {
            loggedIn: false,
            currentView: 'home',
        };
        
        function showAppForLogin() {
            marketingContainer.style.display = 'none';
            appContainer.style.display = 'block';
            document.querySelectorAll('.marketing-nav').forEach(el => el.style.display = 'none');
        }

        function handleLogoutUI() {
            state.loggedIn = false;
            authButton.textContent = 'Login';
            marketingContainer.style.display = 'block';
            appContainer.style.display = 'none';
            document.querySelectorAll('.marketing-nav').forEach(el => el.style.display = 'flex');
        }

        window.addEventListener('userLoggedIn', () => {
            state.loggedIn = true;
            authButton.textContent = 'Logout';
        });

        window.addEventListener('userLoggedOut', () => {
            handleLogoutUI();
            navigateTo('home');
        });

        authButton.addEventListener('click', () => {
            if (state.loggedIn) {
                 window.dispatchEvent(new CustomEvent('userLoggedOutFromButton'));
            } else {
                showAppForLogin();
            }
        });


        function navigateTo(targetId) {
            state.currentView = targetId;

            // Update active state in desktop header
            const currentActiveButton = document.querySelector('.nav-item.nav-active');
            if(currentActiveButton) currentActiveButton.classList.remove('nav-active');
            
            const newActiveButton = document.querySelector(`.nav-item[data-target="${targetId}"]`);
            if (newActiveButton) newActiveButton.classList.add('nav-active');
           
            // Show correct main content section
            contentSections.forEach(section => {
                section.classList.toggle('active', section.id === targetId);
                section.classList.toggle('hidden', section.id !== targetId);
            });
            
            mobileMenu.classList.add('hidden');
            window.scrollTo(0, 0);
        }
        
        const allNavItems = [...navButtons, ...mobileNavButtons, ...directNavLinks];
        allNavItems.forEach(button => {
            button.addEventListener('click', (e) => {
                e.preventDefault();
                const targetId = button.dataset.target || (button.getAttribute('href') ? button.getAttribute('href').substring(1) : null);
                if (targetId) {
                    navigateTo(targetId);
                }
            });
        });
        
        mobileMenuButton.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });

        function renderFeatures(filter = 'all') {
            if (!featuresGrid) return;
            featuresGrid.innerHTML = '';
            const filteredData = filter === 'all' ? featuresData : featuresData.filter(f => f.category === filter);
            filteredData.forEach(feature => {
                const card = document.createElement('div');
                card.className = `feature-card bg-white p-6 rounded-lg shadow-md border border-gray-100 feature-category-${feature.category}`;
                card.innerHTML = `
                    <div class="flex items-center">
                        <span class="text-3xl mr-4">${feature.icon}</span>
                        <h3 class="text-xl font-semibold text-gray-800">${feature.name}</h3>
                    </div>
                    <div class="details">
                        <p class="text-gray-600 mt-2 text-sm">${feature.description}</p>
                        <p class="mt-4 text-sm"><span class="font-semibold text-blue-600">AI-Powered Improvement:</span> ${feature.improvement}</p>
                    </div>
                `;
                card.addEventListener('click', () => {
                    card.classList.toggle('open');
                });
                featuresGrid.appendChild(card);
            });
        }
        
        filterButtons.forEach(button => {
            button.addEventListener('click', () => {
                filterButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                renderFeatures(button.dataset.filter);
            });
        });

        function setupAiCore() {
            const hub = document.getElementById('ai-hub');
            if (!hub) return;
            const container = hub.parentElement;
            if (!container) return;
            const agentTitle = document.getElementById('ai-agent-title');
            const agentDesc = document.getElementById('ai-agent-description');

            const radius = Math.min(container.offsetWidth, container.offsetHeight) / 2 - 60;
            aiAgentsData.forEach((agent, index) => {
                const angle = (index / aiAgentsData.length) * 2 * Math.PI - (Math.PI / 2);
                const x = radius * Math.cos(angle);
                const y = radius * Math.sin(angle);

                const node = document.createElement('div');
                node.id = agent.id;
                node.className = 'ai-agent-node absolute w-32 h-32 rounded-full bg-white border-2 border-blue-200 flex items-center justify-center text-center p-2 text-sm font-semibold shadow-lg';
                node.style.left = '50%';
                node.style.top = '50%';
                node.style.transform = `translate(-50%, -50%) translate(${x}px, ${y}px)`;
                node.textContent = agent.name;

                node.addEventListener('click', () => {
                    if (document.querySelector('.scenario-btn:disabled')) return;
                    container.querySelectorAll('.ai-agent-node').forEach(n => n.classList.remove('active'));
                    node.classList.add('active');
                    agentTitle.textContent = agent.name;
                    agentDesc.textContent = agent.description;
                });
                container.appendChild(node);
            });
            // Default to selecting the user assistant
            const firstNode = document.querySelector('#agent-user'); 
            if (firstNode) {
                firstNode.click();
            }
        }

        function createPath(startNode, endNode, container, id) {
            if (document.getElementById(id)) return document.getElementById(id); // Don't recreate

            const startRect = {
                x: startNode.offsetLeft + startNode.offsetWidth / 2,
                y: startNode.offsetTop + startNode.offsetHeight / 2
            };
            const endRect = {
                x: endNode.offsetLeft + endNode.offsetWidth / 2,
                y: endNode.offsetTop + endNode.offsetHeight / 2
            };

            const length = Math.sqrt(Math.pow(endRect.x - startRect.x, 2) + Math.pow(endRect.y - startRect.y, 2));
            const angle = Math.atan2(endRect.y - startRect.y, endRect.x - startRect.x) * 180 / Math.PI;

            const path = document.createElement('div');
            path.id = id;
            path.className = 'ai-scenario-path';
            path.dataset.length = length;
            path.style.top = `${startRect.y}px`;
            path.style.left = `${startRect.x}px`;
            path.style.transform = `rotate(${angle}deg)`;
            path.style.width = '0px'; // initially hidden
            container.appendChild(path);
            return path;
        }
        
        function runScenario(scenarioId) {
            const scenarioBtns = document.querySelectorAll('.scenario-btn');
            const isRunning = Array.from(scenarioBtns).some(btn => btn.disabled);
            if (isRunning) return;

            scenarioBtns.forEach(btn => {
                btn.disabled = true;
            });

            const nodes = {
                pm: document.getElementById('agent-pm'),
                user: document.getElementById('agent-user'),
                biz: document.getElementById('agent-biz'),
                doc: document.getElementById('agent-doc'),
                acc: document.getElementById('agent-acc'),
            };
            
            for (const key in nodes) {
                if (!nodes[key]) {
                    console.error(`Scenario node '${key}' not found!`);
                    scenarioBtns.forEach(btn => btn.disabled = false);
                    return;
                }
            }
            
            const container = nodes.pm.parentElement;

            const paths = {
                doc_pm: createPath(nodes.doc, nodes.pm, container, 'path-doc-pm'),
                pm_user: createPath(nodes.pm, nodes.user, container, 'path-pm-user'),
                user_biz: createPath(nodes.user, nodes.biz, container, 'path-user-biz'),
                user_doc: createPath(nodes.user, nodes.doc, container, 'path-user-doc'),
                doc_user: createPath(nodes.doc, nodes.user, container, 'path-doc-user'),
            };

            const scenarios = {
                safetyHazard: [
                    { node: nodes.doc, duration: 2500, text: 'A daily log mentions "faulty scaffolding". The Document Analyst scans the text and identifies a critical safety hazard.' },
                    { node: nodes.pm, duration: 3000, text: 'It alerts the Project Optimizer, which immediately pauses all tasks in that area and flags a schedule risk.', path: paths.doc_pm },
                    { node: nodes.user, duration: 3000, text: 'The User Assistant is then triggered to create a high-priority "Safety Inspection" task and alerts the site supervisor.', path: paths.pm_user }
                ],
                weatherDelay: [
                    { node: nodes.pm, duration: 2500, text: 'The Project Optimizer ingests a forecast for heavy rain.' },
                    { node: nodes.user, duration: 3000, text: 'It finds a conflicting "Concrete Pour" on the schedule and notifies the User Assistant with a reschedule suggestion.', path: paths.pm_user },
                    { node: nodes.biz, duration: 3000, text: 'The Business Advisor is also informed to analyze the financial impact of a potential one-day delay on project cash flow.', path: paths.user_biz }
                ],
                smartRFI: [
                    { node: nodes.user, duration: 2000, text: 'A user asks the AI Assistant: "What is the fire rating for the 2nd-floor corridor doors?"' },
                    { node: nodes.doc, duration: 3000, text: 'The query is passed to the Document Analyst, which performs a semantic search across all project specs and drawings.', path: paths.user_doc },
                    { node: nodes.user, duration: 3000, text: 'The Analyst finds the "90-minute" rating in the door schedule and instantly provides the answer and source document to the user.', path: paths.doc_user }
                ]
            };

            const sequence = scenarios[scenarioId];
            if (!sequence) {
                console.error(`Scenario '${scenarioId}' not found!`);
                scenarioBtns.forEach(btn => btn.disabled = false);
                return;
            }

            const allNodes = document.querySelectorAll('.ai-agent-node');
            const allPaths = document.querySelectorAll('.ai-scenario-path');
            
            const resetState = () => {
                allNodes.forEach(n => n.classList.remove('highlight', 'active'));
                allPaths.forEach(p => {
                    p.style.width = '0px';
                    p.style.opacity = '0';
                });
                scenarioBtns.forEach(btn => {
                    btn.disabled = false;
                });
                
                if (nodes.user) {
                    const agentTitle = document.getElementById('ai-agent-title');
                    const agentDesc = document.getElementById('ai-agent-description');
                    const agentData = aiAgentsData.find(a => a.id === nodes.user.id);
                    nodes.user.classList.add('active');
                    if (agentData) {
                        agentTitle.textContent = agentData.name;
                        agentDesc.textContent = agentData.description;
                    }
                }
            };

            let currentIndex = 0;

            function nextStep() {
                allNodes.forEach(n => n.classList.remove('highlight'));
                if (currentIndex >= sequence.length) {
                    setTimeout(resetState, 2000);
                    return;
                }
                const step = sequence[currentIndex];
                const agentTitle = document.getElementById('ai-agent-title');
                const agentDesc = document.getElementById('ai-agent-description');
                
                if (step.node) {
                    step.node.classList.add('highlight');
                    allNodes.forEach(n => n.classList.remove('active'));
                    step.node.classList.add('active');
                    const agentData = aiAgentsData.find(a => a.id === step.node.id);
                    if (agentData) {
                        agentTitle.textContent = agentData.name;
                    }
                    agentDesc.textContent = step.text;
                }
                
                if (step.path) {
                    step.path.style.opacity = '1';
                    step.path.style.width = `${step.path.dataset.length}px`;
                }
                
                currentIndex++;
                setTimeout(nextStep, step.duration);
            }
            
            allNodes.forEach(n => n.classList.remove('highlight', 'active'));
            allPaths.forEach(p => {
                p.style.width = '0px';
                p.style.opacity = '0';
            });
            
            setTimeout(nextStep, 100);
        }
        
        async function handleDemoSubmit(e) {
            e.preventDefault();
            const form = e.target;
            const submitBtn = form.querySelector('button[type="submit"]');
            const feedbackEl = document.getElementById('form-feedback');
            
            if (!db) {
                feedbackEl.textContent = 'Database not connected. Please try again later.';
                feedbackEl.className = 'text-sm text-center mt-4 text-red-600';
                return;
            }

            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';
            feedbackEl.textContent = '';

            try {
                const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
                const collectionPath = `/artifacts/${appId}/public/data/demo-requests`;

                await addDoc(collection(db, collectionPath), {
                    name: form.name.value,
                    email: form.email.value,
                    company: form.company.value,
                    submittedAt: serverTimestamp()
                });

                feedbackEl.textContent = 'Thank you! We will be in touch shortly.';
                feedbackEl.className = 'text-sm text-center mt-4 text-green-600';
                form.reset();
            } catch (error) {
                console.error("Error adding document: ", error);
                feedbackEl.textContent = 'An error occurred. Please try again.';
                feedbackEl.className = 'text-sm text-center mt-4 text-red-600';
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit Request';
            }
        }

        document.getElementById('demo-form')?.addEventListener('submit', handleDemoSubmit);
        document.querySelectorAll('.scenario-btn').forEach(button => {
            button.addEventListener('click', (e) => {
                const scenarioId = e.currentTarget.dataset.scenario;
                if (scenarioId) {
                    runScenario(scenarioId);
                }
            });
        });
        
        renderFeatures();
        
        const aiCoreSection = document.getElementById('ai-core');
        const observer = new ResizeObserver(() => {
            const container = document.querySelector('#ai-hub')?.parentElement;
            if (container) {
                // Clear old nodes and paths before redrawing
                container.querySelectorAll('.ai-agent-node, .ai-scenario-path').forEach(n => n.remove());
                setupAiCore();
            }
        });

        if (aiCoreSection) {
            observer.observe(aiCoreSection);
        }

        initializeFirebase();
        handleLogoutUI(); // Ensure initial state is logged out
    </script>
</body>
</html>